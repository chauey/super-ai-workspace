/* You can add global styles to this file, and also import other style files */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Angular Material theme - using prebuilt theme to avoid injection issues */
@import '@angular/material/prebuilt-themes/indigo-pink.css';

/* AG Grid Styles */
@import 'ag-grid-community/styles/ag-grid.css';
@import 'ag-grid-community/styles/ag-theme-alpine.css';

/* Import shared styles - using @import for compatibility with @tailwind */
@import './app/shared/styles/mixins';
@import './app/shared/styles/utilities';
@import './app/shared/styles/density';

/* CSS Variables for Theming - MUST BE IN GLOBAL STYLES */
:root {
  --primary-color: #3f51b5;
  --accent-color: #ff4081;
  --warn-color: #f44336;
  --success-color: #4caf50;
  --warning-color: #ff9800;
  --info-color: #2196f3;

  /* Light Theme */
  --bg-primary: #ffffff;
  --bg-secondary: #f5f5f5;
  --bg-tertiary: #eeeeee;
  --text-primary: #212121;
  --text-secondary: #757575;
  --text-disabled: #bdbdbd;
  --border-color: #e0e0e0;
  --shadow: 0 2px 4px rgba(0,0,0,0.1);
  --shadow-hover: 0 4px 8px rgba(0,0,0,0.15);
}

/* Dark Theme */
.dark {
  --bg-primary: #121212;
  --bg-secondary: #1e1e1e;
  --bg-tertiary: #2d2d2d;
  --text-primary: #ffffff;
  --text-secondary: #b3b3b3;
  --text-disabled: #666666;
  --border-color: #333333;
  --shadow: 0 2px 4px rgba(0,0,0,0.3);
  --shadow-hover: 0 4px 8px rgba(0,0,0,0.4);
}

/* Global styles for Material + Tailwind integration */
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  transition: background-color 0.3s ease, color 0.3s ease;
}

body {
  font-family: 'Roboto', sans-serif;
  background-color: var(--bg-secondary, #f5f5f5);
  color: var(--text-primary, #212121);
}

/* Dark theme support */
.dark {
  color-scheme: dark;
  background-color: var(--bg-secondary);
  color: var(--text-primary);

  /* Ensure all Material components respect dark theme */
  .mat-mdc-card {
    background-color: var(--bg-primary) !important;
    color: var(--text-primary) !important;
  }

  .mat-mdc-card-title {
    color: var(--text-primary) !important;
  }

  .mat-mdc-card-subtitle {
    color: var(--text-secondary) !important;
  }

  .mat-mdc-card-content {
    color: var(--text-primary) !important;
  }
}

/* Tailwind Custom Utilities for Dark Mode - Reusable across all components */
@layer utilities {
  .bg-card {
    background-color: var(--bg-primary);
  }

  .bg-content {
    background-color: var(--bg-secondary);
  }

  .text-primary {
    color: var(--text-primary);
  }

  .text-secondary {
    color: var(--text-secondary);
  }

  .border-default {
    border-color: var(--border-color);
  }
}

/* Global overrides for hardcoded Tailwind colors to respect dark mode */
.dark {
  /* Override hardcoded white backgrounds */
  .bg-white {
    background-color: var(--bg-primary) !important;
  }

  /* Override hardcoded gray text colors */
  .text-gray-800,
  .text-gray-900 {
    color: var(--text-primary) !important;
  }

  .text-gray-600,
  .text-gray-700 {
    color: var(--text-secondary) !important;
  }

  .text-gray-500 {
    color: var(--text-disabled) !important;
  }

  /* Override hardcoded gray backgrounds */
  .bg-gray-50 {
    background-color: var(--bg-secondary) !important;
  }

  .bg-gray-100 {
    background-color: var(--bg-tertiary) !important;
  }

  /* Override hardcoded borders */
  .border-gray-200,
  .border-gray-300 {
    border-color: var(--border-color) !important;
  }

  /* Override form inputs */
  input.border-gray-300,
  textarea.border-gray-300,
  select.border-gray-300 {
    background-color: var(--bg-primary) !important;
    color: var(--text-primary) !important;
    border-color: var(--border-color) !important;

    &::placeholder {
      color: var(--text-disabled) !important;
    }
  }

  /* Override status/alert colors to work with dark background */
  .bg-yellow-100 {
    background-color: rgba(255, 193, 7, 0.2) !important;
  }

  .text-yellow-800 {
    color: #ffc107 !important;
  }

  .bg-green-100 {
    background-color: rgba(76, 175, 80, 0.2) !important;
  }

  .text-green-600,
  .text-green-700,
  .text-green-800 {
    color: #4caf50 !important;
  }

  .bg-red-100 {
    background-color: rgba(244, 67, 54, 0.2) !important;
  }

  .text-red-500,
  .text-red-800 {
    color: #ef5350 !important;
  }

  /* Keep button colors as-is (they should remain colorful) */
  .bg-blue-500,
  .bg-blue-600,
  .bg-gray-500,
  .bg-gray-600,
  .bg-red-500,
  .bg-red-600 {
    /* These are intentionally colorful buttons - don't override */
  }

  /* Override component-scoped styles that hardcode white/light colors */
  /* Use wildcard attribute selector to match ANY Angular scoped attribute */
  /* This will match .page-container[_ngcontent-ng-cXXXXXX] regardless of hash */
  div[class~="page-container"][class],
  div[class*="page-container"],
  div[class~="demo-section"][class],
  div[class*="demo-section"],
  div[class~="card-container"][class],
  div[class~="content-wrapper"][class] {
    background: var(--bg-primary) !important;
    background-color: var(--bg-primary) !important;
    color: var(--text-primary) !important;
  }

  div[class~="demo-section"][class],
  div[class~="section"][class],
  div[class~="content-section"][class] {
    border-color: var(--border-color) !important;
  }

  /* Override hardcoded text colors in components */
  h1, h2, h3, h4, h5, h6 {
    color: var(--text-primary) !important;
  }

  p {
    color: var(--text-primary) !important;
  }

  /* Override list items and cards */
  .user-card,
  .item-card,
  .info-card {
    background-color: var(--bg-tertiary) !important;
    color: var(--text-primary) !important;
  }

  .user-card p,
  .item-card p,
  .info-card p {
    color: var(--text-secondary) !important;
  }

  /* Override code/pre blocks */
  pre {
    background-color: var(--bg-tertiary) !important;
    color: var(--text-primary) !important;
  }

  /* Override warning/info backgrounds while keeping them visible */
  .warning,
  [style*="background: #fff3cd"],
  [style*="background:#fff3cd"] {
    background-color: rgba(255, 193, 7, 0.2) !important;
    color: var(--text-primary) !important;
  }
}

/* Ensure Material components work with Tailwind */
.mat-mdc-card {
  @apply shadow-md;
  background-color: var(--bg-primary, white);
  color: var(--text-primary, #212121);
  border: 1px solid var(--border-color, #e0e0e0);
}

.mat-mdc-button {
  @apply transition-all duration-200;
}

.mat-mdc-icon-button {
  @apply transition-all duration-200;
}

/* Custom utility classes for Material + Tailwind */
.material-tailwind-card {
  @apply bg-white rounded-lg shadow-md p-6;
  background-color: var(--bg-primary, white);
  color: var(--text-primary, #212121);
}

.material-tailwind-button {
  @apply px-4 py-2 rounded-md font-medium transition-all duration-200;
}

/* Override Material theme colors for light mode */
:not(.dark) {
  .mat-mdc-menu-panel {
    background-color: var(--bg-primary) !important;
    color: var(--text-primary) !important;
    border: 1px solid var(--border-color) !important;

    .mat-mdc-menu-item {
      color: var(--text-primary) !important;
      background-color: transparent !important;

      &:hover {
        background-color: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }

      &:focus {
        background-color: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }

      &:active {
        background-color: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }

      mat-icon {
        color: var(--text-secondary) !important;
      }

      span {
        color: var(--text-primary) !important;
      }
    }
  }

  /* Force text color for all menu items in light mode */
  .mat-mdc-menu-item {
    color: var(--text-primary) !important;

    &:hover {
      color: var(--text-primary) !important;
    }

    &:focus {
      color: var(--text-primary) !important;
    }

    &:active {
      color: var(--text-primary) !important;
    }

    span {
      color: var(--text-primary) !important;
    }
  }

  /* Fix expansion panel headers in light mode */
  .mat-expansion-panel-header {
    color: var(--text-primary) !important;
    background-color: transparent !important;

    &:hover {
      background-color: var(--bg-tertiary) !important;
      color: var(--text-primary) !important;
    }

    &.mat-expanded {
      background-color: var(--bg-tertiary) !important;
      color: var(--text-primary) !important;
    }

    .mat-expansion-panel-header-title {
      color: var(--text-primary) !important;
    }

    .mat-expansion-panel-header-description {
      color: var(--text-secondary) !important;
    }

    mat-icon {
      color: var(--text-secondary) !important;
    }
  }

  /* Force expansion panel header text color in light mode */
  .mat-expansion-panel-header.mat-expansion-panel-header {
    color: var(--text-primary) !important;

    &:hover {
      color: var(--text-primary) !important;
    }

    &.mat-expanded {
      color: var(--text-primary) !important;
    }

    .mat-expansion-panel-header-title {
      color: var(--text-primary) !important;
    }

    .mat-expansion-panel-header-description {
      color: var(--text-secondary) !important;
    }

    mat-icon {
      color: var(--text-secondary) !important;
    }
  }

  /* Additional specificity for expansion panel headers */
  .mat-expansion-panel .mat-expansion-panel-header {
    color: var(--text-primary) !important;

    &:hover {
      color: var(--text-primary) !important;
    }

    &.mat-expanded {
      color: var(--text-primary) !important;
    }

    .mat-expansion-panel-header-title {
      color: var(--text-primary) !important;
    }

    .mat-expansion-panel-header-description {
      color: var(--text-secondary) !important;
    }

    mat-icon {
      color: var(--text-secondary) !important;
    }
  }

  /* Fix selected/active states in light mode */
  .mat-list-item {
    color: var(--text-primary) !important;

    &.mat-list-item-selected {
      background-color: var(--bg-tertiary) !important;
      color: var(--text-primary) !important;
    }

    &:hover {
      background-color: var(--bg-tertiary) !important;
      color: var(--text-primary) !important;
    }

    .mat-list-item-content {
      color: var(--text-primary) !important;
    }
  }

  /* Fix router link active states in light mode */
  .router-link-active {
    background-color: var(--bg-tertiary) !important;
    color: var(--text-primary) !important;

    .mat-list-item-content {
      color: var(--text-primary) !important;
    }
  }

  /* Force all expansion panel text to be visible in light mode */
  .mat-expansion-panel-header[class*="mat-expansion-panel-header"] {
    color: var(--text-primary) !important;

    &:hover {
      color: var(--text-primary) !important;
    }

    &.mat-expanded {
      color: var(--text-primary) !important;
    }

    .mat-expansion-panel-header-title {
      color: var(--text-primary) !important;
    }

    .mat-expansion-panel-header-description {
      color: var(--text-secondary) !important;
    }

    mat-icon {
      color: var(--text-secondary) !important;
    }
  }

  /* Override Material's default expansion panel styling */
  .mat-expansion-panel-header.mat-expansion-panel-header.mat-expansion-panel-header {
    color: var(--text-primary) !important;

    &:hover {
      color: var(--text-primary) !important;
    }

    &.mat-expanded {
      color: var(--text-primary) !important;
    }

    .mat-expansion-panel-header-title {
      color: var(--text-primary) !important;
    }

    .mat-expansion-panel-header-description {
      color: var(--text-secondary) !important;
    }

    mat-icon {
      color: var(--text-secondary) !important;
    }
  }
}

/* Override Material theme colors for dark mode */
.dark {
  .mat-mdc-card {
    background-color: var(--bg-primary);
    color: var(--text-primary);
    border-color: var(--border-color);
  }

  .mat-mdc-toolbar {
    background-color: var(--bg-primary);
    color: var(--text-primary);
  }

  .mat-mdc-sidenav {
    background-color: var(--bg-primary);
    color: var(--text-primary);
  }

  .mat-mdc-list-item {
    color: var(--text-primary);
  }

  .mat-mdc-menu-panel {
    background-color: var(--bg-primary) !important;
    color: var(--text-primary) !important;
    border: 1px solid var(--border-color) !important;

    .mat-mdc-menu-item {
      color: var(--text-primary) !important;
      background-color: transparent !important;

      &:hover {
        background-color: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }

      &:focus {
        background-color: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }

      &:active {
        background-color: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }

      mat-icon {
        color: var(--text-secondary) !important;
      }

      span {
        color: var(--text-primary) !important;
      }
    }
  }

  /* Ensure toolbar buttons maintain proper colors in dark mode */
  .mat-mdc-icon-button {
    color: var(--text-secondary) !important;

    &:hover {
      color: var(--text-primary) !important;
      background-color: var(--bg-tertiary) !important;
    }

    mat-icon {
      color: inherit !important;
    }
  }

  /* Force text color for all menu items in dark mode */
  .mat-mdc-menu-item {
    color: var(--text-primary) !important;

    &:hover {
      color: var(--text-primary) !important;
    }

    &:focus {
      color: var(--text-primary) !important;
    }

    &:active {
      color: var(--text-primary) !important;
    }

    span {
      color: var(--text-primary) !important;
    }
  }
}

/* Global menu styling for all themes */
.mat-mdc-menu-panel {
  background-color: var(--bg-primary) !important;
  color: var(--text-primary) !important;
  border: 1px solid var(--border-color) !important;
  box-shadow: var(--shadow-hover) !important;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  .mat-mdc-menu-item {
    color: var(--text-primary) !important;
    background-color: transparent !important;
    transition: background-color 0.2s ease, color 0.2s ease;

    &:hover {
      background-color: var(--bg-tertiary) !important;
      color: var(--text-primary) !important;
    }

    &.active {
      background-color: var(--primary-color) !important;
      color: white !important;

      mat-icon {
        color: white !important;
      }
    }

    mat-icon {
      color: var(--text-secondary) !important;
      transition: color 0.2s ease;
    }

    span {
      color: var(--text-primary) !important;
    }
  }

  .mat-mdc-divider {
    border-color: var(--border-color) !important;
  }
}

/* Ensure menu items maintain proper colors after menu closes */
.mat-mdc-menu-item.mat-mdc-menu-item {
  color: var(--text-primary) !important;
  background-color: transparent !important;

  &:hover {
    background-color: var(--bg-tertiary) !important;
    color: var(--text-primary) !important;
  }

  mat-icon {
    color: var(--text-secondary) !important;
  }

  span {
    color: var(--text-primary) !important;
  }
}

/* Override Material's default button styling */
.mat-mdc-menu-item.mat-mdc-menu-item.mat-mdc-menu-item {
  color: var(--text-primary) !important;

  &:hover {
    color: var(--text-primary) !important;
  }

  &:focus {
    color: var(--text-primary) !important;
  }

  &:active {
    color: var(--text-primary) !important;
  }
}

/* Additional specificity for menu item states */
.mat-mdc-menu-item {
  &.mat-mdc-menu-item {
    color: var(--text-primary) !important;

    &:hover {
      color: var(--text-primary) !important;
    }

    &:focus {
      color: var(--text-primary) !important;
    }

    &:active {
      color: var(--text-primary) !important;
    }

    &.mat-mdc-menu-item-active {
      color: var(--text-primary) !important;
    }

    &.mat-mdc-menu-item-selected {
      color: var(--text-primary) !important;
    }
  }
}

/* Force menu item text color in all states */
.mat-mdc-menu-item[class*="mat-mdc-menu-item"] {
  color: var(--text-primary) !important;

  &:hover {
    color: var(--text-primary) !important;
  }

  &:focus {
    color: var(--text-primary) !important;
  }

  &:active {
    color: var(--text-primary) !important;
  }

  span {
    color: var(--text-primary) !important;
  }
}

/* Menu backdrop */
.mat-mdc-menu-backdrop {
  background-color: rgba(0, 0, 0, 0.1) !important;
}

/* Ensure menu items are properly styled */
.mat-mdc-menu-item.mat-mdc-menu-item {
  color: var(--text-primary) !important;
  background-color: transparent !important;

  &:hover {
    background-color: var(--bg-tertiary) !important;
  }
}

/* Toolbar button styling to maintain proper colors */
.mat-mdc-icon-button {
  color: var(--text-secondary) !important;

  &:hover {
    color: var(--text-primary) !important;
    background-color: var(--bg-tertiary) !important;
  }

  &:focus {
    color: var(--text-primary) !important;
  }

  mat-icon {
    color: inherit !important;
  }
}

/* Ensure toolbar buttons maintain theme colors */
.app-toolbar {
  .mat-mdc-icon-button {
    color: var(--text-secondary) !important;

    &:hover {
      color: var(--text-primary) !important;
      background-color: var(--bg-tertiary) !important;
    }

    mat-icon {
      color: inherit !important;
    }
  }
}

/* Smooth transitions for theme changes */
* {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

/* Global expansion panel header styling to ensure visibility */
.mat-expansion-panel-header {
  color: var(--text-primary) !important;

  &:hover {
    color: var(--text-primary) !important;
  }

  &.mat-expanded {
    color: var(--text-primary) !important;
  }

  .mat-expansion-panel-header-title {
    color: var(--text-primary) !important;
  }

  .mat-expansion-panel-header-description {
    color: var(--text-secondary) !important;
  }

  mat-icon {
    color: var(--text-secondary) !important;
  }
}

/* Force expansion panel headers to be visible */
.mat-expansion-panel-header.mat-expansion-panel-header {
  color: var(--text-primary) !important;

  &:hover {
    color: var(--text-primary) !important;
  }

  &.mat-expanded {
    color: var(--text-primary) !important;
  }

  .mat-expansion-panel-header-title {
    color: var(--text-primary) !important;
  }

  .mat-expansion-panel-header-description {
    color: var(--text-secondary) !important;
  }

  mat-icon {
    color: var(--text-secondary) !important;
  }
}

/* Custom scrollbar for webkit browsers */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-tertiary, #eeeeee);
}

::-webkit-scrollbar-thumb {
  background: var(--border-color, #e0e0e0);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-disabled, #bdbdbd);
}

/* Focus styles */
.mat-mdc-button:focus,
.mat-mdc-icon-button:focus {
  outline: 2px solid var(--primary-color, #3f51b5);
  outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  :root {
    --border-color: #000000;
    --shadow: 0 2px 4px rgba(0,0,0,0.5);
  }

  .dark {
    --border-color: #ffffff;
    --shadow: 0 2px 4px rgba(255,255,255,0.3);
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
